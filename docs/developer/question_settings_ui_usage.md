# QuestionSettingsUI 使用说明

## 概述

`QuestionSettingsUI` 是一个完全重新设计的题型设置界面组件，支持动态选项生成、完整题目文本显示和详细的日志输出。

## 主要特性

### 1. 动态选项生成
- 根据解析的问卷自动确定每个题目的选项数量
- 为每个选项动态生成对应的输入框
- 显示实际的选项文本而不是通用标签

### 2. 完整题目内容显示
- 在界面上显示题目的完整文本内容
- 通过工具提示显示题目详情和所有选项
- 支持长文本的自动换行和省略显示

### 3. 解析问卷后自动更新
- 解析问卷后自动重新加载界面
- 同步显示最新的题目信息和选项配置
- 保持用户的设置状态

### 4. 详细日志输出
- 记录界面操作的详细日志
- 统计每种题型的数量
- 跟踪选项配置的变更

## 使用方法

### 基本初始化

```python
from ui.components.question_settings_ui import QuestionSettingsUI

# 初始化UI组件
question_ui = QuestionSettingsUI(parent_frame, config_dict)
```

### 与主系统集成

```python
# 解析问卷后同步更新
def after_parsing_questionnaire():
    question_ui.sync_with_main_system(main_app)
    
# 手动更新配置
question_ui.update_config(new_config)

# 保存设置到配置文件
success = question_ui.save_settings_to_config()

# 获取统计信息
stats, total = question_ui.get_statistics()
```

## 支持的题型

1. **单选题** - 支持权重设置和随机选择
2. **多选题** - 支持概率设置和选择数量限制
3. **矩阵题** - 支持多维度评分配置
4. **填空题** - 支持文本模板设置
5. **多项填空** - 支持多个填空项配置
6. **排序题** - 支持位置权重设置
7. **下拉框** - 支持选项概率配置
8. **量表题** - 支持评分权重设置

## 快捷操作

每种题型都提供四个快捷按钮：
- **偏左/偏前**: 设置偏向前面选项的概率分布
- **偏右/偏后**: 设置偏向后面选项的概率分布
- **随机**: 设置为完全随机选择（-1）
- **平均/50%**: 设置为平均概率分布

## 配置格式

UI组件兼容主系统的配置格式：

```python
config = {
    "question_texts": {
        "1": "您的性别",
        "2": "您的年级"
    },
    "option_texts": {
        "1": ["男", "女"],
        "2": ["大一", "大二", "大三", "大四"]
    },
    "single_prob": {
        "1": [0.5, 0.5],
        "2": -1  # 随机
    },
    "multiple_prob": {
        "3": {
            "prob": [50, 30, 20],
            "min_selection": 1,
            "max_selection": 2
        }
    }
}
```

## 日志记录

组件会记录以下类型的日志：

- 界面初始化和重新加载
- 题目和选项的创建过程
- 用户操作（快捷按钮点击等）
- 配置保存和同步过程
- 错误和警告信息

## 最佳实践

1. **解析前准备**: 确保在解析问卷前界面已正确初始化
2. **及时同步**: 解析问卷后立即调用同步方法更新界面
3. **定期保存**: 用户操作后及时保存配置到文件
4. **错误处理**: 监听日志输出以及时发现和处理问题

## 故障排除

### 界面不更新
- 检查是否调用了 `sync_with_main_system()` 方法
- 确认配置数据格式正确
- 查看日志输出是否有错误信息

### 选项显示不正确
- 检查 `option_texts` 配置是否完整
- 确认题目编号与配置中的键值一致
- 验证选项数组长度是否正确

### 操作无响应
- 检查日志级别设置
- 确认事件绑定是否正确
- 验证回调函数是否正常执行

